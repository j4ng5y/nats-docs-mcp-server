# NATS Documentation MCP Server Configuration
# This is an example configuration file showing all available options.
# Copy this file to config.yaml and customize as needed.

# Logging Configuration
# Log level: debug, info, warn, error
# Default: info
log_level: info

# Documentation Fetching Configuration
# Base URL for NATS documentation
# Default: https://docs.nats.io
docs_url: https://docs.nats.io

# Timeout for fetching individual documentation pages
# Format: duration string (e.g., "30s", "1m", "500ms")
# Default: 30s
fetch_timeout: 30s

# Maximum number of retry attempts for failed fetches
# Default: 3
max_retries: 3

# Initial backoff duration for retry attempts (exponential backoff)
# Format: duration string (e.g., "1s", "500ms")
# Default: 1s
retry_backoff: 1s

# Search Configuration
# Maximum number of search results to return per query
# Default: 10
max_search_results: 10

# Caching Configuration
# Directory where documentation cache is stored
# Default: ~/.cache/nats-mcp/
# Set to empty string to disable caching
cache_dir: ~/.cache/nats-mcp/

# Maximum cache age in days before automatic refresh
# Default: 7
cache_max_age: 7

# Synadia Documentation Support
# This section enables support for dual documentation sources: NATS and Synadia
# When enabled, queries are automatically routed to the appropriate documentation source
# or both sources based on keyword classification
#
# Backward Compatibility:
# - Setting synadia.enabled to false (default) maintains NATS-only behavior
# - Existing configurations work unchanged without adding synadia configuration
# - Synadia documentation fetching is optional; if it fails, server continues with NATS only

synadia:
  # Enable Synadia documentation support
  # Set to true to include Synadia documentation alongside NATS documentation
  # Set to false to use NATS documentation only (default)
  # Default: false
  enabled: false

  # Base URL for Synadia documentation
  # Required when synadia.enabled is true, ignored when disabled
  # Default: https://docs.synadia.com
  base_url: https://docs.synadia.com

  # Timeout for fetching Synadia documentation pages
  # Format: duration string (e.g., "30s", "1m", "500ms")
  # This is separate from NATS fetch_timeout for independent control
  # Default: 30s
  fetch_timeout: 30s

# GitHub Documentation Support
# This section enables support for indexing markdown files from NATS GitHub repositories
# When enabled, documentation from GitHub repos is indexed alongside NATS and Syncp docs
#
# Authentication:
# - Requires a GitHub Personal Access Token (PAT) for authentication
# - Token can be provided via config or NATS_DOCS_GITHUB_TOKEN environment variable
# - Rate limits: 5000 requests/hour with token (60 requests/hour without)
#
# Repositories:
# - Supports multiple repositories (default: nats-io/nats-server, nats-io/nats.docs, nats-io/nats)
# - Format: "owner/repo"
# - All markdown files are indexed

github:
  # Enable GitHub documentation support
  # Set to true to include GitHub repository documentation
  # Set to false to disable (default)
  # Default: false
  enabled: false

  # GitHub Personal Access Token for authentication
  # Required when github.enabled is true
  # Can also be set via NATS_DOCS_GITHUB_TOKEN environment variable
  # Token only needs public_repo scope
  # Default: "" (empty)
  token: ""

  # GitHub repositories to index
  # Format: list of "owner/repo" strings
  # All markdown files in these repositories will be indexed
  # Default:
  #   - nats-io/nats-server
  #   - nats-io/nats.docs
  #   - nats-io/nats
  repositories:
    - nats-io/nats-server
    - nats-io/nats.docs
    - nats-io/nats

  # Default branch to fetch from
  # Default: main
  default_branch: main

  # Timeout for fetching GitHub documentation
  # Format: integer (seconds)
  # This is separate from NATS fetch_timeout for independent control
  # Default: 30
  fetch_timeout: 30

# Query Classification Configuration
# This section defines keywords that determine which documentation source(s) to search
# Based on keywords found in the query, the system routes to:
# - NATS documentation if only NATS keywords found
# - Synadia documentation if only Synadia keywords found
# - Both sources if both keywords found or keywords are ambiguous
#
# Example queries:
# - "jetstream basics" → NATS only (contains NATS keyword "jetstream")
# - "control plane setup" → Synadia only (contains Synadia keyword "control-plane")
# - "authentication nats" → Both sources (contains both keywords)
# - "streaming setup" → Both sources (ambiguous, keywords match both)

classification:
  # Keywords specific to Synadia documentation
  # When any of these keywords appear in a query, Synadia documentation is considered
  synadia_keywords:
    - control-plane
    - synadia
    - namespace
    - managed
    - system
    - platform

  # Keywords specific to NATS documentation
  # When any of these keywords appear in a query, NATS documentation is considered
  nats_keywords:
    - jetstream
    - nats-server
    - nats-cli
    - subject
    - stream
    - consumer
    - service
    - rpc
    - kvstore
    - objectstore

  # Keywords specific to GitHub documentation
  # When any of these keywords appear in a query, GitHub documentation is considered
  github_keywords:
    - server
    - implementation
    - code
    - go
    - golang
    - client
    - example
    - tutorial
    - source
    - repository
    - readme
    - github
    - sdk
    - library

# Caching Strategy
# This server uses session-based in-memory caching:
# - Documentation is fetched once at server startup
# - Cache persists for the entire server session
# - Cache is NOT persisted to disk between sessions
# - Each server restart fetches fresh documentation from docs.nats.io
# - Zero network requests after initial startup fetch
#
# Benefits:
# - Always fresh documentation (fetched at startup)
# - No stale data concerns (cache cleared on restart)
# - Fast response times (~1ms for searches after startup)
# - Predictable memory usage (~15-75 MB)
#
# Trade-offs:
# - Startup time includes documentation fetch (5-30 seconds)
# - Requires network connection at startup

# Transport Configuration
# The server supports multiple transport types for different deployment scenarios:
# - stdio: Standard I/O (default) - for local process integrations
# - sse: Server-Sent Events - for web-based clients
# - streamablehttp: Full HTTP - for enterprise deployments

# STDIO Transport Example (default)
# Suitable for local development and Claude Desktop
transport_type: stdio

# SSE Transport Example
# Uncomment below to enable SSE transport
# transport_type: sse
# host: 0.0.0.0
# port: 8080

# StreamableHTTP Transport Example
# Uncomment below to enable StreamableHTTP transport
# transport_type: streamablehttp
# host: 0.0.0.0
# port: 8080

# Transport Host Configuration
# Only used for network-based transports (sse, streamablehttp)
# Examples: localhost, 0.0.0.0, 127.0.0.1, your.domain.com
# Default: localhost
# host: localhost

# Transport Port Configuration
# Only used for network-based transports (sse, streamablehttp)
# Must be a valid port number (1-65535)
# Default: 0 (dynamically assigned, only for stdio transport)
# port: 8080
